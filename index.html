<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belgrano Norte — El Rojito</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --red: #C8102E;
            --red-dark: #8B0000;
            --red-light: #E8304A;
            --red-glow: rgba(200, 16, 46, 0.15);
            --cream: #FFF8F0;
            --warm: #FFF0E6;
            --paper: #FFFDF9;
            --text: #1a0a05;
            --muted: #7a5a50;
            --border: #d4c2ba;
            --stripe-a: #fff8f5;
            --stripe-b: #f2e5df;
            --green: #1a7a4a;
            --green-bg: #e8f5ee;
            --amber: #b85c00;
            --amber-bg: #fff3e0;
            --shadow: 0 2px 12px rgba(200, 16, 46, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--cream);
            color: var(--text);
            min-height: 100vh;
        }

        .header {
            background: var(--red);
            background-image: linear-gradient(135deg, var(--red-dark) 0%, var(--red) 50%, var(--red-light) 100%);
            color: white;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-inner {
            display: flex;
            align-items: center;
            gap: 1.2rem;
            padding: 0.8rem 1.5rem;
            max-width: 1100px;
            margin: 0 auto;
        }

        .lozenge {
            background: white;
            color: var(--red);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.05em;
            padding: 0.25rem 0.7rem;
            border-radius: 6px;
            line-height: 1;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .header-title {
            flex: 1;
        }

        .header-title h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 0.08em;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header-title p {
            font-size: 0.72rem;
            opacity: 0.8;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            font-family: 'DM Mono', monospace;
        }

        .clock-box {
            font-family: 'DM Mono', monospace;
            font-size: 1.5rem;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            letter-spacing: 0.08em;
            text-shadow: 0 0 12px rgba(255, 200, 200, 0.5);
        }

        .controls {
            background: white;
            border-bottom: 2px solid var(--red);
            padding: 0.8rem 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            max-width: 100%;
        }

        .ctrl-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ctrl-label {
            font-size: 0.68rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--muted);
            font-family: 'DM Mono', monospace;
            white-space: nowrap;
        }

        .pill-group {
            display: flex;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .pill {
            padding: 0.4rem 0.9rem;
            background: white;
            color: var(--muted);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
            border-right: 1px solid var(--border);
            white-space: nowrap;
        }

        .pill:last-child {
            border-right: none;
        }

        .pill:hover {
            background: var(--warm);
            color: var(--red);
        }

        .pill.active {
            background: var(--red);
            color: white;
            font-weight: 600;
        }

        .station-selects {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex: 1;
            flex-wrap: wrap;
        }

        .station-selects select {
            background: var(--paper);
            border: 1.5px solid var(--border);
            color: var(--text);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.88rem;
            padding: 0.4rem 0.7rem;
            border-radius: 8px;
            outline: none;
            cursor: pointer;
            transition: border-color 0.15s;
            min-width: 140px;
            flex: 1;
            max-width: 220px;
        }

        .station-selects select:focus {
            border-color: var(--red);
        }

        .arrow-icon {
            color: var(--red);
            font-size: 1.1rem;
            font-weight: 700;
        }

        .next-banner {
            max-width: 1100px;
            margin: 1rem auto 0;
            padding: 0 1.5rem;
        }

        .next-card {
            background: white;
            border-radius: 14px;
            border-left: 5px solid var(--red);
            box-shadow: var(--shadow), 0 0 0 1px var(--border);
            padding: 1rem 1.4rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .next-pulse {
            width: 10px;
            height: 10px;
            background: var(--red);
            border-radius: 50%;
            animation: pulse 1.2s ease infinite;
            flex-shrink: 0;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(200, 16, 46, 0.5);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(200, 16, 46, 0);
            }
        }

        .next-info {
            flex: 1;
        }

        .next-label {
            font-size: 0.65rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--muted);
            font-family: 'DM Mono', monospace;
        }

        .next-time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.4rem;
            color: var(--red);
            line-height: 1;
            letter-spacing: 0.05em;
        }

        .next-detail {
            font-size: 0.82rem;
            color: var(--muted);
            margin-top: 0.2rem;
        }

        .next-detail strong {
            color: var(--text);
        }

        .next-countdown {
            text-align: center;
            background: var(--red-glow);
            border-radius: 10px;
            padding: 0.6rem 1.2rem;
            border: 1px solid rgba(200, 16, 46, 0.2);
        }

        .next-countdown .cd-num {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--red);
            line-height: 1;
        }

        .next-countdown .cd-label {
            font-size: 0.65rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-family: 'DM Mono', monospace;
        }

        .next-tag {
            padding: 0.25rem 0.7rem;
            border-radius: 20px;
            font-size: 0.72rem;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .tag-local {
            background: var(--green-bg);
            color: var(--green);
        }

        .tag-expreso {
            background: #fff0e0;
            color: #b86000;
        }

        .tag-directo {
            background: #e8eaff;
            color: #3040b0;
        }

        .main {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1rem 1.5rem 2rem;
        }

        .section-header {
            display: flex;
            align-items: baseline;
            gap: 0.8rem;
            margin: 1.2rem 0 0.7rem;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            color: var(--red);
        }

        .section-count {
            font-family: 'DM Mono', monospace;
            font-size: 0.75rem;
            color: var(--muted);
        }

        .trains-grid {
            display: grid;
            border-radius: 12px;
            overflow-x: auto;
            border: 1.5px solid var(--border);
            box-shadow: var(--shadow);
            background: white;
        }

        .station-header {
            display: grid;
            grid-template-columns: subgrid;
            grid-column: 1 / -1;
            background: #f0e8e4;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 5;
        }

        .sh-cell {
            padding: 0.5rem 0.6rem;
            font-size: 0.62rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--muted);
            font-family: 'DM Mono', monospace;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            line-height: 1.2;
        }

        .sh-cell:last-child {
            border-right: none;
        }

        .sh-cell.from-col {
            color: var(--red);
            font-weight: 700;
        }

        .sh-cell.to-col {
            color: var(--green);
            font-weight: 700;
        }

        .train-row {
            display: grid;
            grid-template-columns: subgrid;
            grid-column: 1 / -1;
            border-bottom: 1px solid var(--border);
            transition: background 0.12s;
            cursor: default;
        }

        .train-row:last-child {
            border-bottom: none;
        }

        .train-row.even {
            background: var(--stripe-a);
        }

        .train-row.odd {
            background: var(--stripe-b);
        }

        .train-row:hover {
            background: #ffebe5 !important;
        }

        .train-row.is-next {
            background: #fff3f0 !important;
            box-shadow: inset 3px 0 0 var(--red);
        }

        .train-row.past {
            opacity: 0.42;
        }

        .cell {
            padding: 0.55rem 0.6rem;
            border-right: 1px solid var(--border);
            display: flex;
            align-items: center;
            min-height: 40px;
        }

        .cell:last-child {
            border-right: none;
        }

        .col-0 {
            background: rgba(200, 16, 46, 0.04);
        }

        .col-1 {
            background: rgba(180, 60, 0, 0.03);
        }

        .col-2 {
            background: rgba(160, 100, 0, 0.03);
        }

        .col-3 {
            background: rgba(140, 120, 0, 0.03);
        }

        .col-4 {
            background: rgba(120, 140, 0, 0.03);
        }

        .col-5 {
            background: rgba(80, 160, 0, 0.03);
        }

        .col-6 {
            background: rgba(40, 160, 40, 0.03);
        }

        .col-7 {
            background: rgba(0, 160, 80, 0.03);
        }

        .col-8 {
            background: rgba(0, 150, 120, 0.03);
        }

        .col-9 {
            background: rgba(0, 140, 160, 0.03);
        }

        .col-10 {
            background: rgba(0, 100, 200, 0.04);
        }

        .col-11 {
            background: rgba(40, 60, 200, 0.04);
        }

        .col-12 {
            background: rgba(80, 20, 200, 0.04);
        }

        .col-13 {
            background: rgba(120, 0, 180, 0.04);
        }

        .col-14 {
            background: rgba(160, 0, 140, 0.04);
        }

        .col-15 {
            background: rgba(200, 0, 100, 0.04);
        }

        .sh-col-0 {
            background: rgba(200, 16, 46, 0.08);
        }

        .sh-col-1 {
            background: rgba(180, 60, 0, 0.06);
        }

        .sh-col-2 {
            background: rgba(160, 100, 0, 0.06);
        }

        .sh-col-3 {
            background: rgba(140, 120, 0, 0.06);
        }

        .sh-col-4 {
            background: rgba(120, 140, 0, 0.06);
        }

        .sh-col-5 {
            background: rgba(80, 160, 0, 0.06);
        }

        .sh-col-6 {
            background: rgba(40, 160, 40, 0.06);
        }

        .sh-col-7 {
            background: rgba(0, 160, 80, 0.06);
        }

        .sh-col-8 {
            background: rgba(0, 150, 120, 0.06);
        }

        .sh-col-9 {
            background: rgba(0, 140, 160, 0.06);
        }

        .sh-col-10 {
            background: rgba(0, 100, 200, 0.08);
        }

        .sh-col-11 {
            background: rgba(40, 60, 200, 0.08);
        }

        .sh-col-12 {
            background: rgba(80, 20, 200, 0.08);
        }

        .sh-col-13 {
            background: rgba(120, 0, 180, 0.08);
        }

        .sh-col-14 {
            background: rgba(160, 0, 140, 0.08);
        }

        .sh-col-15 {
            background: rgba(200, 0, 100, 0.08);
        }

        .cell-num {
            font-family: 'DM Mono', monospace;
            font-size: 0.72rem;
            color: var(--muted);
            flex-direction: column;
            gap: 2px;
            align-items: flex-start;
        }

        .cell-num .train-n {
            font-weight: 500;
            color: var(--text);
            font-size: 0.75rem;
        }

        .cell-time {
            font-family: 'DM Mono', monospace;
            font-size: 0.88rem;
            font-weight: 500;
            color: var(--text);
        }

        .cell-time.from-time {
            color: var(--red);
            font-weight: 700;
            font-size: 0.95rem;
        }

        .cell-time.to-time {
            color: var(--green);
            font-weight: 700;
            font-size: 0.95rem;
        }

        .cell-time.next-time {
            color: var(--red);
            text-shadow: 0 0 8px rgba(200, 16, 46, 0.3);
        }

        .cell-empty {
            color: #d0c0ba;
            font-size: 0.7rem;
            font-family: 'DM Mono', monospace;
        }

        .no-stop {
            color: #ddd;
            font-size: 1rem;
        }

        .no-results {
            padding: 3rem;
            text-align: center;
            font-family: 'DM Mono', monospace;
            font-size: 0.8rem;
            color: var(--muted);
            letter-spacing: 0.1em;
        }

        @media (max-width: 600px) {
            .header-inner {
                padding: 0.7rem 1rem;
            }

            .controls {
                padding: 0.7rem 1rem;
            }

            .next-banner,
            .main {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            .clock-box {
                font-size: 1.1rem;
            }

            .header-title h1 {
                font-size: 1.4rem;
            }

            .station-selects select {
                max-width: 100%;
            }
        }
    </style>
</head>

<body>

    <header class="header">
        <div class="header-inner">
            <div class="lozenge">FC Belgrano Norte</div>
            <div class="header-title">
                <h1>El Rojito</h1>
                <p>Horario N°20 · Vigente desde 22/10/2024</p>
            </div>
            <div class="clock-box" id="clock">--:--:--</div>
        </div>
    </header>

    <div class="controls">
        <div class="ctrl-group">
            <span class="ctrl-label">Dirección</span>
            <div class="pill-group">
                <button class="pill active" id="btn-vr" onclick="setDir('vr')">→ Villa Rosa</button>
                <button class="pill" id="btn-ret" onclick="setDir('ret')">→ Retiro</button>
            </div>
        </div>

        <div class="ctrl-group">
            <span class="ctrl-label">Día</span>
            <div class="pill-group">
                <button class="pill active" id="btn-lv" onclick="setDay('lv')">Lun–Vie</button>
                <button class="pill" id="btn-sab" onclick="setDay('sab')">Sábado</button>
                <button class="pill" id="btn-dom" onclick="setDay('dom')">Dom/Fer</button>
            </div>
        </div>

        <div class="ctrl-group station-selects">
            <span class="ctrl-label">Desde</span>
            <select id="selFrom" onchange="render()"></select>
            <span class="arrow-icon">→</span>
            <select id="selTo" onchange="render()"></select>
        </div>
    </div>

    <div class="next-banner" id="nextBanner"></div>

    <div class="main">
        <div class="section-header">
            <span class="section-title" id="sectionTitle">Partidas hacia Villa Rosa</span>
            <span class="section-count" id="sectionCount"></span>
        </div>
        <div class="trains-grid" id="grid"></div>
    </div>

    <script>
        const STA = [
            "Retiro", "Saldías", "Cd. Universitaria", "A. del Valle", "M. Padilla",
            "Florida", "Munro", "Carapachay", "V. Adelina", "Boulogne",
            "V. Montes", "Don Torcuato", "A. Sourdeaux", "Cd. Villa de Mayo", "Cd. Los Polvorines",
            "Cd. Ing. P. Nogués", "Cd. Grand Bourg", "Tierras Altas", "Cd. Tortuguitas",
            "M. Alberti", "Del Viso", "C. Grierson", "Villa Rosa"
        ];

        let DATASETS = {
            lv: { vr: [], ret: [] },
            sab: { vr: [], ret: [] },
            dom: { vr: [], ret: [] },
        };

        async function initData() {
            try {
                const resp = await fetch('horarios_por_paginas.json');
                const json = await resp.json();

                for (let pageKey in json) {
                    const pageData = json[pageKey];
                    if (!pageData || pageData.length < 3) continue;

                    const title = pageData[0][0] || "";
                    let dayKey = 'lv';
                    if (title.includes("SÁBADOS")) dayKey = 'sab';
                    else if (title.includes("DOMINGOS")) dayKey = 'dom';

                    const subKey = title.includes("HACIA VILLA ROSA") ? "vr" : "ret";

                    for (let i = 2; i < pageData.length; i++) {
                        const row = pageData[i];

                        if (row[0] && /^\d+$/.test(row[0])) {
                            const formattedRow = [parseInt(row[0])];

                            for (let j = 1; j < row.length; j++) {
                                formattedRow.push(row[j] || null);
                            }
                            DATASETS[dayKey][subKey].push(formattedRow);
                        }
                    }
                }
                render();
            } catch (e) {
                console.error("Error loading schedule:", e);
                const grid = document.getElementById('grid');
                if (grid) grid.innerHTML = `<div class="no-results" style="color:var(--red)">
                    Error al cargar los datos. Por favor, asegúrate de que la URL termine en "/" 
                    o intenta recargar la página.<br><small>${e.message}</small>
                </div>`;
            }
        }

        initData();

        let dir = 'vr';
        let day = 'lv';

        function setDir(d) {
            dir = d;
            document.getElementById('btn-vr').className = 'pill' + (d === 'vr' ? ' active' : '');
            document.getElementById('btn-ret').className = 'pill' + (d === 'ret' ? ' active' : '');
            populateSelects();
            render();
        }

        function setDay(d) {
            day = d;
            ['lv', 'sab', 'dom'].forEach(x => {
                document.getElementById('btn-' + x).className = 'pill' + (x === d ? ' active' : '');
            });
            render();
        }

        function getDataset() {
            return (DATASETS[day] || DATASETS['lv'])[dir] || DATASETS['lv'][dir];
        }

        function getDisplayStations() {
            if (dir === 'vr') return STA;
            return [...STA].reverse();
        }

        function dispToData(dispIdx) {
            return dispIdx;
        }

        function timeToMin(t) {
            if (!t) return null;
            const [h, m] = t.split(':').map(Number);
            return h * 60 + m;
        }

        function nowMin() {
            const n = new Date();
            return n.getHours() * 60 + n.getMinutes();
        }

        function classifyTrain(row) {
            const reachesEnd = !!row[row.length - 1];
            if (dir === 'vr') {
                if (reachesEnd) return 'full';
                if (row[17]) return 'local';
                return 'short';
            } else {
                if (reachesEnd) return 'full';
                if (row[7]) return 'local';
                return 'short';
            }
        }

        function getTrainTag(row) {
            const cls = classifyTrain(row);
            if (cls === 'full') return '<span class="next-tag tag-local">Local</span>';
            if (cls === 'local') return '<span class="next-tag tag-expreso">Corto</span>';
            return '<span class="next-tag tag-directo">Parcial</span>';
        }

        function populateSelects() {
            const stations = getDisplayStations();
            ['selFrom', 'selTo'].forEach((id, si) => {
                const sel = document.getElementById(id);
                const prev = sel.value;
                sel.innerHTML = '<option value="">— Todas —</option>';
                stations.forEach((s, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = s;
                    sel.appendChild(opt);
                });
                if (prev) sel.value = prev;
            });
        }

        function render() {
            const stations = getDisplayStations();
            const dataset = getDataset();
            const fromDisp = parseInt(document.getElementById('selFrom').value);
            const toDisp = parseInt(document.getElementById('selTo').value);
            const fromData = isNaN(fromDisp) ? null : dispToData(fromDisp);
            const toData = isNaN(toDisp) ? null : dispToData(toDisp);

            let colDispIdxs = stations.map((_, i) => i);

            const now = nowMin();
            let rows = dataset.filter(row => {
                if (fromData !== null && !row[fromData + 1]) return false;
                if (toData !== null && !row[toData + 1]) return false;
                if (fromData !== null && toData !== null && fromData >= toData) return false;
                return true;
            });

            let nextTrain = null, nextDiff = Infinity;
            if (fromData !== null) {
                rows.forEach(row => {
                    const t = row[fromData + 1];
                    if (!t) return;
                    let m = timeToMin(t);
                    if (m < now - 120) m += 1440;
                    const diff = m - now;
                    if (diff >= 0 && diff < nextDiff) {
                        nextDiff = diff;
                        nextTrain = row;
                    }
                });
            }

            const banner = document.getElementById('nextBanner');
            if (nextTrain && fromData !== null && nextDiff < 1440) {
                const fromT = nextTrain[fromData + 1];
                const toT = toData !== null ? nextTrain[toData + 1] : null;
                const cdText = nextDiff === 0 ? '¡Ya!' : nextDiff < 60 ? `${nextDiff} min` : `${Math.floor(nextDiff / 60)}h ${nextDiff % 60}m`;
                const fromName = stations[fromDisp];
                const toName = toData !== null ? stations[toDisp] : null;
                banner.innerHTML = `<div class="next-card">
      <div class="next-pulse"></div>
      <div class="next-info">
        <div class="next-label">Próximo tren desde ${fromName}</div>
        <div class="next-time">${fromT}${toT ? ` → ${toT}` : ''}</div>
        <div class="next-detail">
          Tren <strong>#${nextTrain[0]}</strong>
          ${toName ? `· llega a <strong>${toName}</strong> a las <strong style="color:var(--green)">${toT}</strong>` : ''}
          &nbsp; ${getTrainTag(nextTrain)}
        </div>
      </div>
      <div class="next-countdown">
        <div class="cd-num">${cdText}</div>
        <div class="cd-label">para salir</div>
      </div>
    </div>`;
            } else {
                banner.innerHTML = '';
            }

            const dirLabel = dir === 'vr' ? '→ Villa Rosa' : '→ Retiro';
            const dayLabel = { lv: 'Lunes a Viernes', sab: 'Sábados', dom: 'Domingos y Feriados' }[day];
            document.getElementById('sectionTitle').textContent = `Partidas ${dirLabel} · ${dayLabel}`;
            document.getElementById('sectionCount').textContent = `${rows.length} trenes`;

            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            if (rows.length === 0) {
                grid.innerHTML = '<div class="no-results">Sin resultados para esta selección</div>';
                return;
            }

            const cols = colDispIdxs.length;
            const gridCols = `80px repeat(${cols}, minmax(75px, 1fr))`;
            grid.style.gridTemplateColumns = gridCols;

            const hdr = document.createElement('div');
            hdr.className = 'station-header';

            const th0 = document.createElement('div');
            th0.className = 'sh-cell';
            th0.textContent = 'Tren';
            hdr.appendChild(th0);

            colDispIdxs.forEach((di, ci) => {
                const dataIdx = dispToData(di);
                const th = document.createElement('div');
                const colClass = `sh-col-${ci % 16}`;
                th.className = `sh-cell ${colClass}`;
                if (di === fromDisp) th.classList.add('from-col');
                if (di === toDisp) th.classList.add('to-col');

                th.innerHTML = stations[di].replace(' ', '<br>');
                hdr.appendChild(th);
            });
            grid.appendChild(hdr);

            rows.forEach((row, ri) => {
                const isNext = nextTrain && row[0] === nextTrain[0];
                const fromTime = fromData !== null ? row[fromData + 1] : row.find((v, i) => i > 0 && v);
                const fromMin = fromTime ? timeToMin(fromTime) : null;
                let adjMin = fromMin;
                if (adjMin !== null && adjMin < now - 120) adjMin += 1440;
                const isPast = adjMin !== null && adjMin < now && !isNext;

                const tr = document.createElement('div');
                tr.className = `train-row ${ri % 2 === 0 ? 'even' : 'odd'}${isNext ? ' is-next' : ''}${isPast ? ' past' : ''}`;

                const td0 = document.createElement('div');
                td0.className = 'cell cell-num';
                td0.innerHTML = `<span class="train-n">#${row[0]}</span>${getTrainTag(row)}`;
                tr.appendChild(td0);

                colDispIdxs.forEach((di, ci) => {
                    const dataIdx = dispToData(di);
                    const val = row[dataIdx + 1];
                    const td = document.createElement('div');
                    const colClass = `col-${ci % 16}`;
                    td.className = `cell ${colClass}`;

                    if (!val) {
                        const sp = document.createElement('span');
                        sp.className = 'no-stop';
                        sp.textContent = '·';
                        td.appendChild(sp);
                    } else {
                        const sp = document.createElement('span');
                        sp.className = 'cell-time';
                        if (di === fromDisp) sp.classList.add('from-time');
                        else if (di === toDisp) sp.classList.add('to-time');
                        if (isNext && di === fromDisp) sp.classList.add('next-time');
                        sp.textContent = val;
                        td.appendChild(sp);
                    }
                    tr.appendChild(td);
                });

                grid.appendChild(tr);
            });

            if (fromData !== null) {
                const nextRow = grid.querySelector('.train-row.is-next');
                if (nextRow) {
                    setTimeout(() => {
                        nextRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }
        }

        function tick() {
            const n = new Date();
            const pad = x => String(x).padStart(2, '0');
            document.getElementById('clock').textContent =
                `${pad(n.getHours())}:${pad(n.getMinutes())}:${pad(n.getSeconds())}`;
        }

        function autoDay() {
            const d = new Date().getDay();
            if (d === 0) setDay('dom');
            else if (d === 6) setDay('sab');
            else setDay('lv');
        }

        autoDay();
        populateSelects();
        render();
        tick();
        setInterval(tick, 1000);
        setInterval(render, 30000);
    </script>
</body>

</html>